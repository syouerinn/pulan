(function(e){var c=e.document.documentElement,b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},f=b[Modernizr.prefixed("transition")],i={transitions:Modernizr.csstransitions,support3d:Modernizr.csstransforms3d};function d(j,k){j.style.WebkitTransform=k;j.style.msTransform=k;j.style.transform=k}function a(){var j=c.clientWidth,k=e.innerWidth;if(j<k){return k}else{return j}}function g(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}return k}function h(k,j){this.el=k;this.options=g({},this.options);g(this.options,j);this._init()}h.prototype.options={};h.prototype._init=function(){this.grid=this.el.querySelector("section.grid-wrap > ul.grid");this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)"));this.itemsCount=this.gridItems.length;this.slideshow=this.el.querySelector("section.slideshow > ul");this.slideshowItems=[].slice.call(this.slideshow.children);this.current=-1;this.ctrlPrev=this.el.querySelector("section.slideshow > .nav > span.nav-prev");this.ctrlNext=this.el.querySelector("section.slideshow > .nav > span.nav-next");this.ctrlClose=this.el.querySelector("section.slideshow > .nav > span.nav-close");this._initEvents()};h.prototype._initMasonry=function(){var j=this.grid;imagesLoaded(j,function(){new Masonry(j,{itemSelector:"li",columnWidth:j.querySelector(".grid-sizer")})})};h.prototype._initEvents=function(){var j=this;this.gridItems.forEach(function(l,k){l.addEventListener("click",function(){j._openSlideshow(k)})});this.ctrlPrev.addEventListener("click",function(){j._navigate("prev")});this.ctrlNext.addEventListener("click",function(){j._navigate("next")});this.ctrlClose.addEventListener("click",function(){j._closeSlideshow()});e.addEventListener("resize",function(){j._resizeHandler()});document.addEventListener("keydown",function(k){if(j.isSlideshowVisible){var l=k.keyCode||k.which;switch(l){case 37:j._navigate("prev");break;case 39:j._navigate("next");break;case 27:j._closeSlideshow();break}}});e.addEventListener("scroll",function(){if(j.isSlideshowVisible){e.scrollTo(j.scrollPosition?j.scrollPosition.x:0,j.scrollPosition?j.scrollPosition.y:0)}else{j.scrollPosition={x:e.pageXOffset||c.scrollLeft,y:e.pageYOffset||c.scrollTop}}})};h.prototype._openSlideshow=function(k){this.isSlideshowVisible=true;this.current=k;classie.addClass(this.el,"slideshow-open");this._setViewportItems();classie.addClass(this.currentItem,"current");classie.addClass(this.currentItem,"show");if(this.prevItem){classie.addClass(this.prevItem,"show");var j=Number(-1*(a()/2+this.prevItem.offsetWidth/2));d(this.prevItem,i.support3d?"translate3d("+j+"px, -50%, -150px)":"translate("+j+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");var j=Number(a()/2+this.nextItem.offsetWidth/2);d(this.nextItem,i.support3d?"translate3d("+j+"px, -50%, -150px)":"translate("+j+"px)")}};h.prototype._navigate=function(l){if(this.isAnimating){return}if(l==="next"&&this.current===this.itemsCount-1||l==="prev"&&this.current===0){this._closeSlideshow();return}this.isAnimating=true;this._setViewportItems();var s=this,p=this.currentItem.offsetWidth,q=i.support3d?"translate3d(-"+Number(a()/2+p/2)+"px, -50%, -150px)":"translate(-"+Number(a()/2+p/2)+"px)",j=i.support3d?"translate3d("+Number(a()/2+p/2)+"px, -50%, -150px)":"translate("+Number(a()/2+p/2)+"px)",k="",r,m,n;if(l==="next"){r=i.support3d?"translate3d( -"+Number((a()*2)/2+p/2)+"px, -50%, -150px )":"translate(-"+Number((a()*2)/2+p/2)+"px)";m=i.support3d?"translate3d( "+Number((a()*2)/2+p/2)+"px, -50%, -150px )":"translate("+Number((a()*2)/2+p/2)+"px)"}else{r=i.support3d?"translate3d( "+Number((a()*2)/2+p/2)+"px, -50%, -150px )":"translate("+Number((a()*2)/2+p/2)+"px)";m=i.support3d?"translate3d( -"+Number((a()*2)/2+p/2)+"px, -50%, -150px )":"translate(-"+Number((a()*2)/2+p/2)+"px)"}classie.removeClass(s.slideshow,"animatable");if(l==="next"&&this.current<this.itemsCount-2||l==="prev"&&this.current>1){n=this.slideshowItems[l==="next"?this.current+2:this.current-2];d(n,m);classie.addClass(n,"show")}var o=function(){classie.addClass(s.slideshow,"animatable");classie.removeClass(s.currentItem,"current");var u=l==="next"?s.nextItem:s.prevItem;classie.addClass(u,"current");d(s.currentItem,l==="next"?q:j);if(s.nextItem){d(s.nextItem,l==="next"?k:r)}if(s.prevItem){d(s.prevItem,l==="next"?r:k)}if(n){d(n,l==="next"?j:q)}var t=function(v){if(i.transitions){if(v.propertyName.indexOf("transform")===-1){return false}this.removeEventListener(f,t)}if(s.prevItem&&l==="next"){classie.removeClass(s.prevItem,"show")}else{if(s.nextItem&&l==="prev"){classie.removeClass(s.nextItem,"show")}}if(l==="next"){s.prevItem=s.currentItem;s.currentItem=s.nextItem;if(n){s.nextItem=n}}else{s.nextItem=s.currentItem;s.currentItem=s.prevItem;if(n){s.prevItem=n}}s.current=l==="next"?s.current+1:s.current-1;s.isAnimating=false};if(i.transitions){s.currentItem.addEventListener(f,t)}else{t()}};setTimeout(o,25)};h.prototype._closeSlideshow=function(l){classie.removeClass(this.el,"slideshow-open");classie.removeClass(this.slideshow,"animatable");var j=this,k=function(m){if(i.transitions){if(m.target.tagName.toLowerCase()!=="ul"){return}this.removeEventListener(f,k)}classie.removeClass(j.currentItem,"current");classie.removeClass(j.currentItem,"show");if(j.prevItem){classie.removeClass(j.prevItem,"show")}if(j.nextItem){classie.removeClass(j.nextItem,"show")}j.slideshowItems.forEach(function(n){d(n,"")});j.isSlideshowVisible=false};if(i.transitions){this.el.addEventListener(f,k)}else{k()}};h.prototype._setViewportItems=function(){this.currentItem=null;this.prevItem=null;this.nextItem=null;if(this.current>0){this.prevItem=this.slideshowItems[this.current-1]}if(this.current<this.itemsCount-1){this.nextItem=this.slideshowItems[this.current+1]}this.currentItem=this.slideshowItems[this.current]};h.prototype._resizeHandler=function(){var j=this;function k(){j._resize();j._resizeTimeout=null}if(this._resizeTimeout){clearTimeout(this._resizeTimeout)}this._resizeTimeout=setTimeout(k,50)};h.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var j=Number(-1*(a()/2+this.prevItem.offsetWidth/2));d(this.prevItem,i.support3d?"translate3d("+j+"px, -50%, -150px)":"translate("+j+"px)")}if(this.nextItem){var j=Number(a()/2+this.nextItem.offsetWidth/2);d(this.nextItem,i.support3d?"translate3d("+j+"px, -50%, -150px)":"translate("+j+"px)")}}};e.CBPGridGallery=h})(window);